<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ColorGrid Joy - A relaxing color-by-number web mini-game running fully in your browser.">
  <meta name="keywords" content="ColorGrid Joy, color by number, web mini game, puzzle game, relaxing game">
  <title>ColorGrid Joy - Deng Anliang</title>

  <link rel="icon" type="image/png" href="/assets/images/favicon.png">

  <link rel="stylesheet" href="/assets/css/themes.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/components.css">
  <link rel="stylesheet" href="/assets/css/utilities.css">

  <link rel="canonical" href="https://denganliang.com/en/games/colorgrid-joy.html">
  <link rel="alternate" hreflang="zh" href="/games/colorgrid-joy.html">
  <link rel="alternate" hreflang="en" href="/en/games/colorgrid-joy.html">
  <link rel="alternate" hreflang="x-default" href="/games/colorgrid-joy.html">

  <style>
    .game-shell {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.25rem;
    }

    .game-panel {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 1.25rem;
    }

    .game-actions {
      display: grid;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .pattern-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.65rem;
      align-items: flex-end;
    }

    .pattern-field {
      display: grid;
      gap: 0.35rem;
      min-width: 140px;
    }

    .pattern-label {
      font-size: 0.82rem;
      color: var(--text-secondary);
      font-weight: 600;
    }

    .pattern-select {
      padding: 0.5rem 0.6rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: 0.9rem;
      min-width: 150px;
    }

    .palette {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .color-btn {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      border: 2px solid transparent;
      cursor: pointer;
      transition: transform 0.2s ease, border-color 0.2s ease;
      position: relative;
    }

    .color-btn.active {
      border-color: var(--text-primary);
      transform: scale(1.08);
    }

    .color-btn .color-num {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.35);
      pointer-events: none;
    }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .progress-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 0.75rem;
      align-items: center;
      margin-bottom: 1rem;
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background: var(--bg-secondary);
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-fill {
      width: 0;
      height: 100%;
      background: var(--accent-color);
      transition: width 0.2s ease;
    }

    .progress-text {
      font-weight: 600;
      color: var(--text-secondary);
      white-space: nowrap;
    }

    .board-wrap {
      display: flex;
      justify-content: center;
    }

    .board {
      width: min(92vw, 620px);
      aspect-ratio: 1;
      display: grid;
      grid-template-columns: repeat(16, 1fr);
      grid-template-rows: repeat(16, 1fr);
      gap: 1px;
      background: var(--border-color);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
      user-select: none;
      touch-action: manipulation;
    }

    .cell {
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.72rem;
      font-weight: 600;
      color: #6b7280;
      cursor: pointer;
    }

    .cell.blocked {
      cursor: default;
      background: #f3f4f6;
      color: transparent;
    }

    .cell.filled {
      color: transparent;
    }

    .cell.wrong {
      outline: 2px solid #ef4444;
      outline-offset: -2px;
    }

    .status-text {
      margin-top: 0.75rem;
      color: var(--text-secondary);
    }

    .status-text.done {
      color: #16a34a;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-content">
      <a href="/en/" class="navbar-logo">Deng Anliang</a>
      <ul class="navbar-menu">
        <li><a href="/en/">Home</a></li>
        <li><a href="/en/about/">About</a></li>
        <li><a href="/en/projects/">Projects</a></li>
        <li><a href="/en/tools/">Tools</a></li>
        <li><a href="/en/games/">Games</a></li>
        <li><a href="/en/blog/">Blog</a></li>
      </ul>
      <div class="navbar-actions">
        <button class="lang-toggle" aria-label="Switch language">中文</button>
        <button class="theme-toggle" aria-label="Toggle theme"></button>
      </div>
    </div>
  </nav>

  <main class="main-content">
    <div class="container">
      <div class="breadcrumb">
        <a href="/en/games/">Games</a>
        <span class="breadcrumb-separator">/</span>
        <span>ColorGrid Joy</span>
      </div>

      <h1>ColorGrid Joy</h1>
      <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
        Choose a color number and fill matching numbered cells. Complete all cells to finish the picture.
      </p>

      <div class="game-shell">
        <section class="game-panel">
          <div class="game-actions">
            <div class="pattern-controls">
              <label class="pattern-field" for="category-select">
                <span class="pattern-label">Theme</span>
                <select id="category-select" class="pattern-select"></select>
              </label>
              <label class="pattern-field" for="pattern-select">
                <span class="pattern-label">Pattern</span>
                <select id="pattern-select" class="pattern-select"></select>
              </label>
              <button id="shuffle-btn" class="btn btn-secondary btn-sm" type="button">Random</button>
            </div>
            <div class="palette" id="palette"></div>
            <div class="action-buttons">
              <button id="undo-btn" class="btn btn-secondary btn-sm" type="button">Undo</button>
              <button id="hint-btn" class="btn btn-secondary btn-sm" type="button">Hint</button>
              <button id="reset-btn" class="btn btn-secondary btn-sm" type="button">Reset</button>
            </div>
          </div>

          <div class="progress-row">
            <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
            <div class="progress-text" id="progress-text">0 / 0</div>
          </div>

          <div class="status-text" id="pattern-text">Current pattern: loading...</div>

          <div class="board-wrap">
            <div class="board" id="board" aria-label="ColorGrid Joy board"></div>
          </div>

          <div class="status-text" id="status-text">Current color: #1. Let's start painting.</div>
        </section>

        <section class="game-panel">
          <h2 style="font-size: 1.1rem; margin-bottom: 0.75rem;">How to play</h2>
          <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">0. Choose a theme (Zodiac, Constellation, Pets, Art).</p>
          <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">1. Pick a numbered color from the palette.</p>
          <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">2. Tap cells with the same number to fill them.</p>
          <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">3. Wrong taps flash red; use undo to step back.</p>
          <p style="color: var(--text-secondary);">4. Use hint anytime to locate a valid next cell.</p>
        </section>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <ul class="footer-links">
        <li><a href="/en/about/">About</a></li>
        <li><a href="/en/blog/">Blog</a></li>
        <li><a href="/en/projects/">Projects</a></li>
        <li><a href="/en/tools/">Tools</a></li>
        <li><a href="/en/games/">Games</a></li>
      </ul>
      <p style="margin-bottom: 0.5rem;">Contact: <a href="mailto:i@denganliang.com">i@denganliang.com</a></p>
      <p>&copy; 2026 Deng Anliang. All rights reserved.</p>
    </div>
  </footer>

  <script src="/assets/js/theme-switcher.js"></script>
  <script src="/assets/js/i18n.js"></script>
  <script src="/assets/js/main.js"></script>
  <script>
    const GRID_SIZE = 16;
    const colorMap = {
      1: '#ef4444',
      2: '#f59e0b',
      3: '#22c55e',
      4: '#3b82f6',
      5: '#a855f7'
    };

    const categoryOptions = [
      { value: 'all', label: 'All Themes' },
      { value: 'zodiac', label: 'Zodiac' },
      { value: 'constellation', label: 'Constellation' },
      { value: 'pet', label: 'Pets' },
      { value: 'art', label: 'Art & Creative' }
    ];

    function createGrid() {
      return Array.from({ length: GRID_SIZE }, () => Array(GRID_SIZE).fill(0));
    }

    function paint(grid, x, y, color) {
      if (x < 0 || x >= GRID_SIZE || y < 0 || y >= GRID_SIZE) {
        return;
      }
      grid[y][x] = color;
    }

    function fillRect(grid, x, y, width, height, color) {
      for (let row = y; row < y + height; row += 1) {
        for (let column = x; column < x + width; column += 1) {
          paint(grid, column, row, color);
        }
      }
    }

    function fillCircle(grid, centerX, centerY, radius, color) {
      for (let row = centerY - radius; row <= centerY + radius; row += 1) {
        for (let column = centerX - radius; column <= centerX + radius; column += 1) {
          const distance = ((column - centerX) ** 2) + ((row - centerY) ** 2);
          if (distance <= radius ** 2) {
            paint(grid, column, row, color);
          }
        }
      }
    }

    function drawLine(grid, startX, startY, endX, endY, color) {
      let x = startX;
      let y = startY;
      const deltaX = Math.abs(endX - startX);
      const stepX = startX < endX ? 1 : -1;
      const deltaY = -Math.abs(endY - startY);
      const stepY = startY < endY ? 1 : -1;
      let error = deltaX + deltaY;

      while (true) {
        paint(grid, x, y, color);
        if (x === endX && y === endY) {
          break;
        }

        const doubled = 2 * error;
        if (doubled >= deltaY) {
          error += deltaY;
          x += stepX;
        }
        if (doubled <= deltaX) {
          error += deltaX;
          y += stepY;
        }
      }
    }

    function drawStar(grid, x, y, color) {
      paint(grid, x, y, color);
      paint(grid, x - 1, y, color);
      paint(grid, x + 1, y, color);
      paint(grid, x, y - 1, color);
      paint(grid, x, y + 1, color);
    }

    function gridToRows(grid) {
      return grid.map(row => row.join(''));
    }

    function makePattern(id, category, name, drawFn) {
      const grid = createGrid();
      drawFn(grid);
      return { id, category, name, rows: gridToRows(grid) };
    }

    function makePatternRows(id, category, name, rows) {
      return { id, category, name, rows };
    }

    const patternCatalog = [
      makePatternRows('zodiac-dragon', 'zodiac', 'Zodiac · Dragon', [
        '0000000000000000',
        '0000000330000000',
        '0000003333000000',
        '0000033223300000',
        '0000332222230000',
        '0003322111223000',
        '0033221111122300',
        '0332211441112230',
        '3322114441112230',
        '0332211111122300',
        '0033221111223000',
        '0003322222230000',
        '0000332223300000',
        '0000033333000000',
        '0000003330000000',
        '0000000300000000'
      ]),
      makePatternRows('zodiac-rabbit', 'zodiac', 'Zodiac · Rabbit', [
        '0000002200220000',
        '0000002200220000',
        '0000002200220000',
        '0000002200220000',
        '0000022222220000',
        '0000222222222000',
        '0002222111222200',
        '0022222111222220',
        '0022222222222220',
        '0022211331122220',
        '0002223333222200',
        '0000222222222000',
        '0000022222220000',
        '0000002222200000',
        '0000000222000000',
        '0000000000000000'
      ]),
      makePatternRows('zodiac-snake', 'zodiac', 'Zodiac · Snake', [
        '0000000000000000',
        '0000033333330000',
        '0000332222233000',
        '0003322222223300',
        '0003322332223300',
        '0000333332223300',
        '0000000332223300',
        '0000033322233000',
        '0000332222230000',
        '0003322222330000',
        '0033222233300000',
        '0032223333000000',
        '0032233330000000',
        '0003333310000000',
        '0000333000000000',
        '0000000000000000'
      ]),
      makePatternRows('zodiac-rat', 'zodiac', 'Zodiac · Rat', [
        '0000000000000000',
        '0000002200220000',
        '0000022222220000',
        '0000222222222000',
        '0002222111222200',
        '0022222111222220',
        '0022222222222220',
        '0022221331222220',
        '0002223333222200',
        '0000223333222000',
        '0000022222220000',
        '0000002222222000',
        '0000000222222200',
        '0000000022222300',
        '0000000003333000',
        '0000000000000000'
      ]),
      makePatternRows('zodiac-ox', 'zodiac', 'Zodiac · Ox', [
        '0000000000000000',
        '0000020000200000',
        '0000222002220000',
        '0002222222222000',
        '0022222222222200',
        '0222211221122220',
        '0222222222222220',
        '0222221111222220',
        '0022221331222200',
        '0002223333222000',
        '0000222222220000',
        '0000022222200000',
        '0000002200220000',
        '0000002200220000',
        '0000002200220000',
        '0000000000000000'
      ]),
      makePatternRows('zodiac-tiger', 'zodiac', 'Zodiac · Tiger', [
        '0000000000000000',
        '0000002222200000',
        '0000022222220000',
        '0000222121222000',
        '0002221111112200',
        '0022211221122220',
        '0022222222222220',
        '0022211111122220',
        '0022221331222220',
        '0002223333222200',
        '0000222222222000',
        '0000022222220000',
        '0000002200220000',
        '0000002200220000',
        '0000000000000000',
        '0000000000000000'
      ]),
      makePatternRows('zodiac-horse', 'zodiac', 'Zodiac · Horse', [
        '0000000000000000',
        '0000000000000000',
        '0000000000000000',
        '0000001110000000',
        '0000012221000000',
        '0000122222100000',
        '0000122112210000',
        '0000122222221000',
        '0000012222221000',
        '0000001222210000',
        '0000000122210000',
        '0000000012100000',
        '0000000001000000',
        '0000000000000000',
        '0000000000000000',
        '0000000300000000'
      ]),
      makePatternRows('zodiac-goat', 'zodiac', 'Zodiac · Goat', [
        '0000000000000000',
        '0000003000300000',
        '0000033000330000',
        '0000222222220000',
        '0002222222222000',
        '0022221122112220',
        '0022222222222220',
        '0022213333122220',
        '0002223333222200',
        '0000222222222000',
        '0000022222220000',
        '0000002222200000',
        '0000002200220000',
        '0000002200220000',
        '0000000300300000',
        '0000000000000000'
      ]),
      makePatternRows('zodiac-monkey', 'zodiac', 'Zodiac · Monkey', [
        '0000000000000000',
        '0000022000220000',
        '0000222202220000',
        '0002222222222000',
        '0022221111222200',
        '0222211221122220',
        '0222222222222220',
        '0222213333122220',
        '0022223333222200',
        '0002222222222000',
        '0000222222220000',
        '0000022202220000',
        '0000002200220000',
        '0000000003330000',
        '0000000033300000',
        '0000000000000000'
      ]),
      makePatternRows('zodiac-rooster', 'zodiac', 'Zodiac · Rooster', [
        '0000000101000000',
        '0000001111100000',
        '0000000222200000',
        '0000022222220000',
        '0000222222222000',
        '0002222111222200',
        '0022222222222220',
        '0022222333322220',
        '0002222333322200',
        '0000222222222000',
        '0000022222220000',
        '0000002222200000',
        '0000002202200000',
        '0000002202200000',
        '0000003300300000',
        '0000000000000000'
      ]),
      makePatternRows('zodiac-dog', 'zodiac', 'Zodiac · Dog', [
        '0000000000000000',
        '0000020000200000',
        '0000220000220000',
        '0002222222220000',
        '0022222222222200',
        '0022211221122200',
        '0022222222222200',
        '0022221111222200',
        '0002221331222000',
        '0000223333220000',
        '0000022222200000',
        '0000002222000000',
        '0000000000000000',
        '0000000000000000',
        '0000000000000000',
        '0000000000000000'
      ]),
      makePatternRows('zodiac-pig', 'zodiac', 'Zodiac · Pig', [
        '0000000000000000',
        '0000002200220000',
        '0000022222220000',
        '0000222222222000',
        '0022221111222200',
        '0022221111222200',
        '0022222222222220',
        '0022221331222220',
        '0002223333222200',
        '0000223333222000',
        '0000022222220000',
        '0000002222220000',
        '0000002200220000',
        '0000000000033000',
        '0000000000330000',
        '0000000000000000'
      ]),
      makePattern('const-orion', 'constellation', 'Constellation · Orion', grid => {
        const stars = [[3, 3], [6, 5], [8, 7], [10, 9], [5, 11], [11, 11], [13, 4]];
        stars.forEach(([x, y]) => drawStar(grid, x, y, 5));
        drawLine(grid, 3, 3, 6, 5, 4);
        drawLine(grid, 6, 5, 8, 7, 4);
        drawLine(grid, 8, 7, 10, 9, 4);
        drawLine(grid, 10, 9, 11, 11, 4);
        drawLine(grid, 8, 7, 5, 11, 4);
        drawLine(grid, 6, 5, 13, 4, 4);
      }),
      makePattern('const-dipper', 'constellation', 'Constellation · Big Dipper', grid => {
        const stars = [[2, 5], [4, 4], [6, 5], [8, 6], [10, 7], [12, 8], [13, 10]];
        stars.forEach(([x, y]) => drawStar(grid, x, y, 5));
        drawLine(grid, 2, 5, 4, 4, 4);
        drawLine(grid, 4, 4, 6, 5, 4);
        drawLine(grid, 6, 5, 8, 6, 4);
        drawLine(grid, 8, 6, 10, 7, 4);
        drawLine(grid, 10, 7, 12, 8, 4);
        drawLine(grid, 12, 8, 13, 10, 4);
      }),
      makePattern('const-cassiopeia', 'constellation', 'Constellation · Cassiopeia', grid => {
        const stars = [[2, 8], [5, 5], [8, 8], [11, 5], [14, 8]];
        stars.forEach(([x, y]) => drawStar(grid, x, y, 5));
        drawLine(grid, 2, 8, 5, 5, 4);
        drawLine(grid, 5, 5, 8, 8, 4);
        drawLine(grid, 8, 8, 11, 5, 4);
        drawLine(grid, 11, 5, 14, 8, 4);
      }),
      makePattern('const-scorpio', 'constellation', 'Constellation · Scorpio', grid => {
        const stars = [[3, 4], [5, 6], [7, 8], [9, 10], [11, 11], [13, 10], [14, 8]];
        stars.forEach(([x, y]) => drawStar(grid, x, y, 5));
        drawLine(grid, 3, 4, 5, 6, 4);
        drawLine(grid, 5, 6, 7, 8, 4);
        drawLine(grid, 7, 8, 9, 10, 4);
        drawLine(grid, 9, 10, 11, 11, 4);
        drawLine(grid, 11, 11, 13, 10, 4);
        drawLine(grid, 13, 10, 14, 8, 4);
      }),
      makePattern('const-leo', 'constellation', 'Constellation · Leo', grid => {
        const stars = [[3, 9], [5, 7], [7, 6], [10, 6], [12, 8], [13, 11]];
        stars.forEach(([x, y]) => drawStar(grid, x, y, 5));
        drawLine(grid, 3, 9, 5, 7, 4);
        drawLine(grid, 5, 7, 7, 6, 4);
        drawLine(grid, 7, 6, 10, 6, 4);
        drawLine(grid, 10, 6, 12, 8, 4);
        drawLine(grid, 12, 8, 13, 11, 4);
      }),
      makePattern('const-taurus', 'constellation', 'Constellation · Taurus', grid => {
        const stars = [[4, 4], [6, 6], [8, 8], [10, 6], [12, 4], [8, 11]];
        stars.forEach(([x, y]) => drawStar(grid, x, y, 5));
        drawLine(grid, 4, 4, 6, 6, 4);
        drawLine(grid, 6, 6, 8, 8, 4);
        drawLine(grid, 8, 8, 10, 6, 4);
        drawLine(grid, 10, 6, 12, 4, 4);
        drawLine(grid, 8, 8, 8, 11, 4);
      }),
      makePattern('const-gemini', 'constellation', 'Constellation · Gemini', grid => {
        const stars = [[4, 4], [4, 8], [4, 12], [11, 4], [11, 8], [11, 12], [7, 6], [8, 10]];
        stars.forEach(([x, y]) => drawStar(grid, x, y, 5));
        drawLine(grid, 4, 4, 4, 12, 4);
        drawLine(grid, 11, 4, 11, 12, 4);
        drawLine(grid, 4, 4, 11, 4, 4);
        drawLine(grid, 4, 12, 11, 12, 4);
        drawLine(grid, 4, 8, 11, 8, 4);
      }),
      makePattern('const-lyra', 'constellation', 'Constellation · Lyra', grid => {
        const stars = [[5, 5], [8, 4], [11, 5], [10, 9], [6, 9], [8, 12]];
        stars.forEach(([x, y]) => drawStar(grid, x, y, 5));
        drawLine(grid, 5, 5, 8, 4, 4);
        drawLine(grid, 8, 4, 11, 5, 4);
        drawLine(grid, 11, 5, 10, 9, 4);
        drawLine(grid, 10, 9, 6, 9, 4);
        drawLine(grid, 6, 9, 5, 5, 4);
        drawLine(grid, 6, 9, 8, 12, 4);
        drawLine(grid, 10, 9, 8, 12, 4);
      }),
      makePatternRows('pet-cat', 'pet', 'Pet · Cat Face', [
        '0000000000000000',
        '0000000000000000',
        '0000000000000000',
        '0000000000000000',
        '0000200000200000',
        '0002320002320000',
        '0002332223320000',
        '0002333333320000',
        '0002313331320000',
        '0002333333320000',
        '0000231313200000',
        '0000022222000000',
        '0000000000000000',
        '0000000000000000',
        '0000000000000000',
        '0000000000000000'
      ]),
      makePattern('pet-paw', 'pet', 'Pet · Paw Print', grid => {
        fillCircle(grid, 8, 10, 3, 2);
        fillCircle(grid, 4, 5, 2, 2);
        fillCircle(grid, 7, 4, 2, 2);
        fillCircle(grid, 10, 4, 2, 2);
        fillCircle(grid, 13, 5, 2, 2);
      }),
      makePattern('pet-fish', 'pet', 'Pet · Small Fish', grid => {
        fillCircle(grid, 8, 8, 4, 3);
        drawLine(grid, 11, 8, 14, 6, 4);
        drawLine(grid, 11, 8, 14, 10, 4);
        drawLine(grid, 14, 6, 14, 10, 4);
        fillCircle(grid, 6, 8, 1, 5);
      }),
      makePatternRows('pet-dog', 'pet', 'Pet · Dog Face', [
        '0000000000000000',
        '0000020000200000',
        '0000220000220000',
        '0002222222220000',
        '0022222222222200',
        '0022211221122200',
        '0022222222222200',
        '0022221111222200',
        '0002221331222000',
        '0000223333220000',
        '0000022222200000',
        '0000002222000000',
        '0000000000000000',
        '0000000000000000',
        '0000000000000000',
        '0000000000000000'
      ]),
      makePatternRows('pet-bunny', 'pet', 'Pet · Bunny', [
        '0000000000000000',
        '0000002200220000',
        '0000002200220000',
        '0000002200220000',
        '0000002222220000',
        '0000022222222000',
        '0000222222222200',
        '0002222111222220',
        '0002222111222220',
        '0002222222222220',
        '0000222133122200',
        '0000022333222000',
        '0000002222220000',
        '0000000222200000',
        '0000000000000000',
        '0000000000000000'
      ]),
      makePattern('pet-turtle', 'pet', 'Pet · Turtle', grid => {
        fillCircle(grid, 8, 9, 4, 3);
        fillCircle(grid, 8, 9, 2, 2);
        fillCircle(grid, 8, 4, 1, 2);
        fillCircle(grid, 4, 9, 1, 2);
        fillCircle(grid, 12, 9, 1, 2);
        fillCircle(grid, 6, 13, 1, 2);
        fillCircle(grid, 10, 13, 1, 2);
      }),
      makePatternRows('pet-bird', 'pet', 'Pet · Penguin', [
        '0000000000000000',
        '0000000000000000',
        '0000000000000000',
        '0000001111000000',
        '0000011111100000',
        '0000112112110000',
        '0000122112210000',
        '0000122442210000',
        '0000122222210000',
        '0000112222110000',
        '0000011111100000',
        '0000044004400000',
        '0000000000000000',
        '0000000000000000',
        '0000000000000000',
        '0000000000000000'
      ]),
      makePatternRows('pet-hamster', 'pet', 'Pet · Hamster', [
        '0000000000000000',
        '0000000000000000',
        '0000022000220000',
        '0000222202220000',
        '0002222222222000',
        '0022222222222200',
        '0022211221122200',
        '0022222222222200',
        '0022213331222200',
        '0022223333222200',
        '0002222222222000',
        '0000222222220000',
        '0000022222200000',
        '0000002222000000',
        '0000000000000000',
        '0000000000000000'
      ]),
      makePattern('art-heart', 'art', 'Art · Heart', grid => {
        for (let y = 0; y < GRID_SIZE; y += 1) {
          for (let x = 0; x < GRID_SIZE; x += 1) {
            const normalizedX = (x - 7.5) / 7;
            const normalizedY = (y - 7.5) / 7;
            const value = ((normalizedX ** 2 + normalizedY ** 2 - 1) ** 3) - (normalizedX ** 2 * normalizedY ** 3);
            if (value <= 0) {
              paint(grid, x, y, 1);
            }
          }
        }
      }),
      makePattern('art-butterfly', 'art', 'Art · Butterfly', grid => {
        fillCircle(grid, 5, 6, 3, 4);
        fillCircle(grid, 11, 6, 3, 4);
        fillCircle(grid, 5, 10, 3, 5);
        fillCircle(grid, 11, 10, 3, 5);
        drawLine(grid, 8, 4, 8, 12, 2);
        drawLine(grid, 8, 4, 6, 2, 1);
        drawLine(grid, 8, 4, 10, 2, 1);
      }),
      makePattern('art-spiral', 'art', 'Art · Spiral', grid => {
        for (let t = 0; t <= 22; t += 0.08) {
          const radius = 0.22 * t;
          const x = Math.round(8 + radius * Math.cos(t));
          const y = Math.round(8 + radius * Math.sin(t));
          const color = (Math.floor(t / 2.8) % 5) + 1;
          paint(grid, x, y, color);
        }
      }),
      makePattern('art-snowflake', 'art', 'Art · Snowflake', grid => {
        drawLine(grid, 8, 2, 8, 13, 4);
        drawLine(grid, 2, 8, 13, 8, 4);
        drawLine(grid, 3, 3, 12, 12, 4);
        drawLine(grid, 12, 3, 3, 12, 4);
        fillCircle(grid, 8, 8, 1, 5);
      }),
      makePattern('art-kite', 'art', 'Art · Kite', grid => {
        drawLine(grid, 8, 2, 13, 8, 2);
        drawLine(grid, 13, 8, 8, 13, 3);
        drawLine(grid, 8, 13, 3, 8, 4);
        drawLine(grid, 3, 8, 8, 2, 5);
        drawLine(grid, 8, 13, 10, 15, 1);
        drawLine(grid, 10, 15, 12, 14, 1);
      }),
      makePattern('art-lotus', 'art', 'Art · Lotus', grid => {
        fillCircle(grid, 8, 9, 2, 2);
        fillCircle(grid, 8, 6, 2, 1);
        fillCircle(grid, 5, 8, 2, 4);
        fillCircle(grid, 11, 8, 2, 4);
        fillCircle(grid, 6, 11, 2, 3);
        fillCircle(grid, 10, 11, 2, 3);
      }),
      makePattern('art-cube', 'art', 'Art · Cube', grid => {
        drawLine(grid, 4, 6, 9, 3, 2);
        drawLine(grid, 9, 3, 13, 6, 2);
        drawLine(grid, 13, 6, 8, 9, 2);
        drawLine(grid, 8, 9, 4, 6, 2);
        drawLine(grid, 4, 6, 4, 11, 4);
        drawLine(grid, 8, 9, 8, 14, 4);
        drawLine(grid, 13, 6, 13, 11, 4);
        drawLine(grid, 4, 11, 8, 14, 3);
        drawLine(grid, 8, 14, 13, 11, 3);
      }),
      makePattern('art-wave', 'art', 'Art · Wave', grid => {
        for (let x = 1; x <= 14; x += 1) {
          const y1 = Math.round(6 + Math.sin(x / 2) * 2);
          const y2 = Math.round(9 + Math.sin((x / 2) + 1.4) * 2);
          const y3 = Math.round(12 + Math.sin((x / 2) + 2.8) * 2);
          paint(grid, x, y1, 2);
          paint(grid, x, y2, 4);
          paint(grid, x, y3, 5);
        }
      })
    ];

    const boardElement = document.getElementById('board');
    const paletteElement = document.getElementById('palette');
    const categorySelectElement = document.getElementById('category-select');
    const patternSelectElement = document.getElementById('pattern-select');
    const shuffleButton = document.getElementById('shuffle-btn');
    const progressFillElement = document.getElementById('progress-fill');
    const progressTextElement = document.getElementById('progress-text');
    const patternTextElement = document.getElementById('pattern-text');
    const statusTextElement = document.getElementById('status-text');

    const undoButton = document.getElementById('undo-btn');
    const hintButton = document.getElementById('hint-btn');
    const resetButton = document.getElementById('reset-btn');

    let boardData = [];
    let paintedState = [];
    const historyStack = [];
    let paintableTotal = 0;
    const paletteNumbers = Object.keys(colorMap).map(number => Number(number));
    let currentCategory = 'all';
    let currentPattern = patternCatalog[0];
    let activeColor = 1;

    function setStatus(text, done = false) {
      statusTextElement.textContent = text;
      statusTextElement.classList.toggle('done', done);
    }

    function setActiveColor(colorNumber, silent = false) {
      activeColor = colorNumber;
      document.querySelectorAll('.color-btn').forEach(button => {
        button.classList.toggle('active', Number(button.dataset.color) === colorNumber);
      });
      if (!silent) {
        setStatus(`Current color: #${colorNumber}. Keep painting.`);
      }
    }

    function getFilteredPatterns() {
      if (currentCategory === 'all') {
        return patternCatalog;
      }
      return patternCatalog.filter(pattern => pattern.category === currentCategory);
    }

    function renderCategoryOptions() {
      categorySelectElement.innerHTML = categoryOptions.map(option => `
        <option value="${option.value}">${option.label}</option>
      `).join('');
      categorySelectElement.value = currentCategory;
    }

    function renderPatternOptions(preferredPatternId = currentPattern.id) {
      const patterns = getFilteredPatterns();
      patternSelectElement.innerHTML = patterns.map(pattern => `
        <option value="${pattern.id}">${pattern.name}</option>
      `).join('');

      const selectedPattern = patterns.find(pattern => pattern.id === preferredPatternId) || patterns[0];
      patternSelectElement.value = selectedPattern.id;
      return selectedPattern;
    }

    function loadPattern(patternId, announce = true) {
      const pattern = patternCatalog.find(item => item.id === patternId);
      if (!pattern) {
        return;
      }

      currentPattern = pattern;
      boardData = pattern.rows.join('').split('').map(number => Number(number));
      paintedState = new Array(boardData.length).fill(false);
      paintableTotal = boardData.filter(number => number > 0).length;
      historyStack.length = 0;
      setActiveColor(1, true);
      renderBoard();
      updateProgress();
      patternTextElement.textContent = `Current pattern: ${pattern.name}`;

      if (announce) {
        setStatus(`Switched to pattern: ${pattern.name}.`);
      } else {
        setStatus('Current color: #1. Let\'s start painting.');
      }
    }

    function updateProgress() {
      const paintedCount = paintedState.filter(Boolean).length;
      const percentage = paintableTotal === 0 ? 0 : Math.round((paintedCount / paintableTotal) * 100);
      progressFillElement.style.width = `${percentage}%`;
      progressTextElement.textContent = `${paintedCount} / ${paintableTotal}`;

      if (paintedCount === paintableTotal) {
        setStatus(`Great job! You completed "${currentPattern.name}".`, true);
      }
    }

    function renderPalette() {
      paletteElement.innerHTML = paletteNumbers.map(colorNumber => `
        <button
          class="color-btn ${colorNumber === activeColor ? 'active' : ''}"
          type="button"
          data-color="${colorNumber}"
          style="background:${colorMap[colorNumber]};"
          aria-label="Select color ${colorNumber}"
        >
          <span class="color-num">${colorNumber}</span>
        </button>
      `).join('');

      paletteElement.querySelectorAll('.color-btn').forEach(button => {
        button.addEventListener('click', () => {
          setActiveColor(Number(button.dataset.color));
        });
      });
    }

    function renderBoard() {
      boardElement.innerHTML = boardData.map((targetNumber, index) => {
        const isBlocked = targetNumber === 0;
        const isFilled = paintedState[index];
        const classNames = ['cell'];

        if (isBlocked) classNames.push('blocked');
        if (isFilled) classNames.push('filled');

        const cellText = isBlocked || isFilled ? '' : targetNumber;
        const backgroundColor = isFilled ? colorMap[targetNumber] : '';

        return `
          <button
            type="button"
            class="${classNames.join(' ')}"
            data-index="${index}"
            style="background:${backgroundColor};"
            ${isBlocked ? 'disabled' : ''}
          >${cellText}</button>
        `;
      }).join('');

      boardElement.querySelectorAll('.cell').forEach(cell => {
        if (cell.classList.contains('blocked')) {
          return;
        }

        cell.addEventListener('click', () => handleCellClick(Number(cell.dataset.index), cell));
      });
    }

    function flashWrong(cellElement) {
      cellElement.classList.add('wrong');
      setTimeout(() => cellElement.classList.remove('wrong'), 220);
    }

    function handleCellClick(index, cellElement) {
      if (paintedState[index]) {
        return;
      }

      const targetNumber = boardData[index];
      if (targetNumber !== activeColor) {
        flashWrong(cellElement);
        setStatus(`This cell is #${targetNumber}. Switch color first.`);
        return;
      }

      paintedState[index] = true;
      historyStack.push(index);
      renderBoard();
      updateProgress();
    }

    function undoLast() {
      const lastIndex = historyStack.pop();
      if (lastIndex === undefined) {
        setStatus('Nothing to undo yet.');
        return;
      }

      paintedState[lastIndex] = false;
      renderBoard();
      updateProgress();
      setStatus('Last step undone.');
    }

    function showHint() {
      let targetIndex = boardData.findIndex((targetNumber, index) => !paintedState[index] && targetNumber === activeColor);

      if (targetIndex === -1) {
        targetIndex = boardData.findIndex((targetNumber, index) => !paintedState[index] && targetNumber > 0);
        if (targetIndex !== -1) {
          setActiveColor(boardData[targetIndex], true);
        }
      }

      if (targetIndex === -1) {
        setStatus('Everything is complete. No hints needed.', true);
        return;
      }

      const hintCell = boardElement.querySelector(`[data-index="${targetIndex}"]`);
      if (hintCell) {
        hintCell.classList.add('wrong');
        setTimeout(() => hintCell.classList.remove('wrong'), 320);
      }
      setStatus(`Hint: try the highlighted #${boardData[targetIndex]} cell.`);
    }

    function resetGame() {
      loadPattern(currentPattern.id, false);
      setStatus(`Reset "${currentPattern.name}". Start again!`);
    }

    function switchCategory(category) {
      currentCategory = category;
      const selectedPattern = renderPatternOptions(currentPattern.id);
      loadPattern(selectedPattern.id, true);
    }

    function shufflePattern() {
      const patterns = getFilteredPatterns();
      if (patterns.length === 0) {
        return;
      }

      const alternatives = patterns.filter(pattern => pattern.id !== currentPattern.id);
      const candidates = alternatives.length > 0 ? alternatives : patterns;
      const randomPattern = candidates[Math.floor(Math.random() * candidates.length)];
      patternSelectElement.value = randomPattern.id;
      loadPattern(randomPattern.id, true);
    }

    undoButton.addEventListener('click', undoLast);
    hintButton.addEventListener('click', showHint);
    resetButton.addEventListener('click', resetGame);
    categorySelectElement.addEventListener('change', event => switchCategory(event.target.value));
    patternSelectElement.addEventListener('change', event => loadPattern(event.target.value, true));
    shuffleButton.addEventListener('click', shufflePattern);

    renderPalette();
    renderCategoryOptions();
    const initialPattern = renderPatternOptions(currentPattern.id);
    loadPattern(initialPattern.id, false);
  </script>
</body>
</html>
